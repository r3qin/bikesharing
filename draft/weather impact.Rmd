---
title: "weather impact"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
df<-read.csv("https://raw.githubusercontent.com/cai0909/data/main/data.csv")
head(df)
```
#Weather Impact on bike rental

Since our original data was aggregated on a hourly basis. To analyze weather's impact on bike rental, we will first turn the data into daily basis.

```{r}
library(dplyr)
total_sum<-df %>% group_by(Year,Month,Day) %>% summarize(number=sum(num)) 
day<-df %>% group_by(Year,Month,Day) %>% slice_head(n=1)
by_day<-day %>% left_join(total_sum,by=c('Year','Month','Day'),keep=FALSE) %>% subset(select=-c(X,Hour,num,Member.type));
head(by_day)

```

First, we visualized the average number of trips per day in different temperatures.Clearly from the graph below,we can see that the number of trips ramps up quickly between 0 and 60 degrees, but above 60 degrees or so thereâ€™s a much weaker relationship between rental and temperature. 

```{r}
library(ggplot2)
temp_count<- by_day %>% group_by(TAVG) %>% summarize(num=mean(number))
ggplot(temp_count,aes(TAVG,num))+
  geom_col()+
  labs(title="Impact of temperature on number of trips per day",y="average trips per day",x="average temperature (Fahrenheit)")+
  scale_x_continuous(breaks=c(20,30,40,50,60,70,80,90,100))+
  theme_grey(16)+
  theme(plot.title = element_text(face="bold"))
```
At around 55 degree, there is a extremely high number of bike rentals. We found this is mainly associated with special events-National cherry blossom festival in DC rather than with temperature.

```{r}
head(by_day[by_day$TAVG==temp_count[temp_count$num==max(temp_count$num),]$TAVG,],1)
```


Next, we visualized the impact of rainy days. It's surprising to see that the rainy days are not necessarily associated with less rentals.In fact, on the day with extremely large rains, the number of trips is actually pretty high. Also, it's interesting to see that number of trips on workdays are less affected by rains than on weekends. A reasonable guess is that on weekdays people cannot avoid renting bikes for commuting no matter if it is rainy or not.

```{r}
prcp_count<- by_day %>% group_by(PRCP,workdays) %>% summarize(num=mean(number));
ggplot(prcp_count,aes(x=PRCP,y=num,color=workdays))+
  geom_point(alpha=0.5)+
  geom_smooth(se = FALSE)+
  facet_wrap(vars(workdays),nrow=1)+
  labs(title="Impact of rains on workdays versus non-workdays",subtitle="Number of trips on workdays are less affected by raining  ",y="Average trips per day",x=
         "PRCP(inches)")+
    theme_gray(15)+
  theme(plot.title = element_text(face="bold"))
```

Then, we looked into the impact of snow. The impact of snow is very obvious as average number of trips drops drastically on snowy days. And with the increasing severeness of snow, the number of trips decreases proportionally. 

```{r}
library(forcats)
by_snowfall<-by_day %>% mutate(ifsnow=if_else(SNOW>0,"Snowy","Not snowy") ) 
ggplot(by_snowfall,aes(x=as_factor(ifsnow),y=number,fill=ifsnow))+
  geom_boxplot(varwidth=TRUE)+
labs(title="Distribution of daily trip numbers by snow",y="Number of trips",subtitle = "Number of trips daily drops drastically on snowy days",fill="Weather")+
  scale_fill_manual(values=c("#E69F00", "#56B4E9"))+
  theme_grey(16)+
  theme(plot.title = element_text(face="bold"),
        axis.title.x = element_blank())
```



```{r}
ggplot(by_day[by_day$SNWD!=0,],aes(x=SNWD,y=number))+
  geom_point(aes(color=workdays))+
  labs(title="Impact of snow depth on number of trips",y="Number of trips",subtitle = "Only data on snowy days are included",x="Snow Depth (inches)")+
  theme_grey(16)+
  theme(plot.title = element_text(face="bold"))
```

#Interactive part 

Since most of days in DC have precipitation of less than 1 inches, points are clustered in the left of the static graph of precipitation and it is hard to tell whether different levels of rains have different impact on bike rental. Therefore, we created an interactive scatter plot which allows zooming of the x axis using the mouse or touch. Such interactivity allows us to look into the impact of specific range of precipitation. 

In fact, we found that precipitation has a diminishing marginal effect. That is the difference between no rain and 0.1 inches of rain is more significant than the difference between 0.5 and 0.6 inches.And the correlation between rain and lower ridership is less clear partly because there are fewer observations in the data set.


